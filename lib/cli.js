// Generated by CoffeeScript 2.5.1
(function() {
  var Server, YAML, createClient, ensureDirExists, fs, getSources, printHelp;

  fs = require('fs');

  YAML = require('yaml');

  require('./ext');

  ({createClient} = require('./client'));

  ({Server} = require('./server'));

  exports.run = function() {
    var _agn, _node, command, dir, file, sources;
    [_node, _agn, command, file] = process.argv;
    switch (command) {
      case 'build':
        dir = `${process.cwd()}/build`;
        ensureDirExists(dir);
        if (file == null) {
          file = 'api.yml';
        }
        sources = getSources(file);
        Server(sources)({
          dir: `${dir}/server`
        });
        return createClient(sources);
      default:
        return printHelp();
    }
  };

  getSources = function(file) {
    var api, cwd, functions, i, key, len, name, ref;
    name = file.split('.')[0];
    cwd = process.cwd();
    api = YAML.parse(fs.readFileSync(`${cwd}/${file}`, 'utf-8'));
    functions = {};
    ref = Object.keys(api.functions);
    for (i = 0, len = ref.length; i < len; i++) {
      key = ref[i];
      functions[key] = fs.readFileSync(`${cwd}/functions/${key}.coffee`, 'utf-8');
    }
    return {name, api, functions};
  };

  ensureDirExists = function(dir) {
    if (!fs.existsSync(dir)) {
      return fs.mkdirSync(dir);
    }
  };

  printHelp = function() {
    return console.log('printHelp');
  };

}).call(this);
