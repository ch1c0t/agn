// Generated by CoffeeScript 2.5.1
(function() {
  var Validate, createCoffeeFile, createFunctionWithInput, createFunctionWithoutInput, createPackageFile, createRootDirectory, create_validateOutputOf, fs, root;

  fs = require('fs');

  ({Validate} = require('./validator'));

  root = false;

  exports.createClient = function(sources) {
    console.log('from createCLient()');
    createRootDirectory();
    createPackageFile(sources.build);
    return createCoffeeFile(sources);
  };

  createRootDirectory = function() {
    root = `${process.cwd()}/build/client`;
    return fs.mkdirSync(root);
  };

  createPackageFile = function({name}) {
    var spec;
    spec = {
      name: `${name}.client`,
      version: '0.0.0',
      dependencies: {
        axios: 'latest'
      }
    };
    return fs.writeFileSync(`${root}/package.json`, JSON.stringify(spec));
  };

  createCoffeeFile = function({build, api}) {
    var functions;
    functions = (Object.keys(api.functions)).map(function(fn) {
      if (api.functions[fn].in) {

      } else {
        //createFunctionWithInput fn, api
        return createFunctionWithoutInput(fn, api);
      }
    });
    return fs.writeFileSync(`${root}/index.coffee`, `axios = require 'axios'

address = ${build.address}
HTTP = axios

${functions.join("\n\n")}`);
  };

  createFunctionWithInput = function(name, api) {};

  createFunctionWithoutInput = function(name, api) {
    var badResponse;
    badResponse = 'the server responded with the status #{response.status}';
    return `${create_validateOutputOf(name, api.functions[name].out, api.types)}

exports.${name} = ->
  response = await HTTP.post address, fn: '${name}'

  if response.status is 200
    output = response.data.out
    validateOutputOf_${name} output
    output
  else
    throw "${name}: ${badResponse}."`;
  };

  create_validateOutputOf = function(fn, type, types) {
    var badOutput;
    badOutput = '#{value}:#{typeof value} was received';
    return `validateOutputOf_${fn} = (value) ->
  error = no

${Validate({types})({type}).indent()}

  if error
    throw new TypeError "${fn} requires ${type} output, but ${badOutput}."`;
  };

}).call(this);
